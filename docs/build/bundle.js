var app=function(){"use strict";function t(){}function e(t){return t()}function n(){return Object.create(null)}function r(t){t.forEach(e)}function o(t){return"function"==typeof t}function s(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function c(e,n,r){e.$$.on_destroy.push(function(e,...n){if(null==e)return t;const r=e.subscribe(...n);return r.unsubscribe?()=>r.unsubscribe():r}(n,r))}function a(t,e){t.appendChild(e)}function i(t,e,n){t.insertBefore(e,n||null)}function l(t){t.parentNode.removeChild(t)}function u(t){return document.createElement(t)}function d(t){return document.createTextNode(t)}function h(){return d(" ")}function f(t,e,n,r){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)}function p(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function P(t){return""===t?null:+t}function b(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}function m(t,e){t.value=null==e?"":e}function _(t,e,n,r){t.style.setProperty(e,n,r?"important":"")}let g;function v(t){g=t}function y(t){(function(){if(!g)throw new Error("Function called outside component initialization");return g})().$$.on_mount.push(t)}const E=[],S=[],x=[],N=[],I=Promise.resolve();let O=!1;function A(t){x.push(t)}let $=!1;const w=new Set;function R(){if(!$){$=!0;do{for(let t=0;t<E.length;t+=1){const e=E[t];v(e),T(e.$$)}for(v(null),E.length=0;S.length;)S.pop()();for(let t=0;t<x.length;t+=1){const e=x[t];w.has(e)||(w.add(e),e())}x.length=0}while(E.length);for(;N.length;)N.pop()();O=!1,$=!1,w.clear()}}function T(t){if(null!==t.fragment){t.update(),r(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(A)}}const C=new Set;function L(t,e){-1===t.$$.dirty[0]&&(E.push(t),O||(O=!0,I.then(R)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function D(s,c,a,i,u,d,h=[-1]){const f=g;v(s);const p=s.$$={fragment:null,ctx:null,props:d,update:t,not_equal:u,bound:n(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(f?f.$$.context:[]),callbacks:n(),dirty:h,skip_bound:!1};let P=!1;if(p.ctx=a?a(s,c.props||{},((t,e,...n)=>{const r=n.length?n[0]:e;return p.ctx&&u(p.ctx[t],p.ctx[t]=r)&&(!p.skip_bound&&p.bound[t]&&p.bound[t](r),P&&L(s,t)),e})):[],p.update(),P=!0,r(p.before_update),p.fragment=!!i&&i(p.ctx),c.target){if(c.hydrate){const t=function(t){return Array.from(t.childNodes)}(c.target);p.fragment&&p.fragment.l(t),t.forEach(l)}else p.fragment&&p.fragment.c();c.intro&&((b=s.$$.fragment)&&b.i&&(C.delete(b),b.i(m))),function(t,n,s){const{fragment:c,on_mount:a,on_destroy:i,after_update:l}=t.$$;c&&c.m(n,s),A((()=>{const n=a.map(e).filter(o);i?i.push(...n):r(n),t.$$.on_mount=[]})),l.forEach(A)}(s,c.target,c.anchor),R()}var b,m;v(f)}function U(t){return{enumerable:!0,value:t}}function M(t){return{enumerable:!0,writable:!0,value:t}}let k={},q=()=>!0,F=()=>({}),H=t=>t,B=(t,e,n,r)=>t.apply(n,r)&&e.apply(n,r),Q=(t,e,n,[r,o])=>e.call(n,t.call(n,r,o),o),Y=(t,e)=>Object.freeze(Object.create(t,e));function V(t,e,n){return t.reduce(((t,e)=>function(...r){return n(t,e,this,r)}),e)}function X(t){return Y(this,{fn:U(t)})}let j={},J=X.bind(j),W={},G=X.bind(W);function z(t,e){return e.filter((e=>t.isPrototypeOf(e)))}function Z(t,e,...n){let r=V(z(W,n).map((t=>t.fn)),q,B),o=V(z(j,n).map((t=>t.fn)),H,Q);return Y(this,{from:U(t),to:U(e),guards:U(r),reducers:U(o)})}let K={},tt={},et=Z.bind(K),nt=Z.bind(tt,null);function rt(t,e,n){return ht(e,t,n,this.immediates)||t}function ot(t){let e=new Map;for(let n of t)e.has(n.from)||e.set(n.from,[]),e.get(n.from).push(n);return e}let st={enter:H};function ct(...t){let e=z(K,t),n=z(tt,t),r={final:U(0===t.length),transitions:U(ot(e))};return n.length&&(r.immediates=U(n),r.enter=U(rt)),Y(st,r)}let at={enter(t,e,n){return this.fn.call(e,e.context,n).then((t=>e.send({type:"done",data:t}))).catch((t=>e.send({type:"error",error:t}))),t}},it={enter(t,e,n){if(e.child=pt(this.machine,(t=>{e.onChange(t),e.child==t&&t.machine.state.value.final&&(delete e.child,e.send({type:"done",data:t.context}))}),e.context,n),e.child.machine.state.value.final){let n=e.child.context;return delete e.child,ht(e,t,{type:"done",data:n},this.transitions.get("done"))}return t}};function lt(t,...e){let n=U(ot(e));return ut.isPrototypeOf(t)?Y(it,{machine:U(t),transitions:n}):Y(at,{fn:U(t),transitions:n})}let ut={get state(){return{name:this.current,value:this.states[this.current]}}};function dt(t,e,n=F){return"string"!=typeof t&&(n=e||F,e=t,t=Object.keys(e)[0]),k._create&&k._create(t,e),Y(ut,{context:U(n),current:U(t),states:U(e)})}function ht(t,e,n,r){let{context:o}=t;for(let{to:s,guards:c,reducers:a}of r)if(c(o,n)){t.context=a.call(t,o,n);let r=e.original||e,c=Y(r,{current:U(s),original:{value:r}});return c.state.value.enter(c,t,n)}}let ft={send(t){this.machine=function(t,e){let n=e.type||e,{machine:r}=t,{value:o}=r.state;return o.transitions.has(n)&&ht(t,r,e,o.transitions.get(n))||r}(this,t),this.onChange(this)}};function pt(t,e,n,r){let o=Object.create(ft,{machine:M(t),context:M(t.context(n,r)),onChange:U(e)});return o.send=o.send.bind(o),o.machine=o.machine.state.value.enter(o.machine,o,r),o}function Pt(t,e){throw new Error(`Cannot transition from ${t} to unknown state: ${e}`)}k._create=function(t,e){if(!(t in e))throw new Error(`Initial state [${t}] is not a known state.`);for(let t in e){let n=e[t];for(let[,r]of n.transitions)for(let{to:n}of r)n in e||Pt(t,n)}};const{fromCharCode:bt}=String,mt=t=>t.charCodeAt(0);class _t extends EventTarget{constructor(t){super(),this.device=t,this.interfaceNumber=0,this.endpointIn=0,this.endpointOut=0,this.queue=[],this.transferInflight=!1}onReceive(t){}onReceiveError(t){}setEndpoints(){let t=this.device.configuration.interfaces;console.log("Interfaces",this.device.configuration.interfaces),t.forEach((t=>{console.log("Element",t),t.alternates.forEach((e=>{255==e.interfaceClass&&(this.interfaceNumber=t.interfaceNumber,e.endpoints.forEach((t=>{"out"==t.direction&&(this.endpointOut=t.endpointNumber),"in"==t.direction&&(this.endpointIn=t.endpointNumber)})))}))})),0===this.endpointIn&&console.error("endpointIn is 0"),0===this.endpointOut&&console.error("endpointOut is 0")}async connect(){let t=async()=>{try{const e=await this.device.transferIn(this.endpointIn,64);this.onReceive(e.data),t()}catch(t){this.onReceiveError(t)}};try{if(await this.device.open(),null===this.device.configuration)return this.device.selectConfiguration(1);await this.setEndpoints(),console.log("Interface number:",this.interfaceNumber),console.log("Configuration:",this.device.configuration),await this.device.claimInterface(this.interfaceNumber);try{await this.device.selectAlternateInterface(this.interfaceNumber,this.endpointIn)}catch(t){}await this.device.controlTransferOut({requestType:"class",recipient:"interface",request:34,value:1,index:this.interfaceNumber}),t()}catch(t){throw console.error(t),t}}async disconnect(){return this.device.controlTransferOut({requestType:"class",recipient:"interface",request:34,value:0,index:this.interfaceNumber}).then((()=>this.device.close()))}send(t){return console.log("sending",t,this.endpointOut),this.device.transferOut(this.endpointOut,t)}queueMessage(t){if(queue.length>5e3)return console.warn("You have queued too many messages, have more chill");this.queue.push(t)}async processQueue(){if(0===this.queue.length)return;if(this.transferInflight)return;this.transferInflight=!0;const t=this.queue.shift();try{await this.send(t)}catch(e){console.error(e),this.queue.unshift(t)}this.transferInflight=!1}startQueue(){this.stopQueue(),this.queueInterval=setInterval(this.processQueue.bind(this),1)}stopQueue(){this.queueInterval&&clearInterval(this.queueInterval)}}const gt=["P_PWM","P_DRIVE","P_PITCH","P_OCT","P_GLIDE","P_INTERVAL","P_NOISE","P_MIXRESO","P_ROTATE","P_SCALE","P_MICROTUNE","P_STRIDE","P_SENS","P_A","P_D","P_S","P_R","P_ENV1_UNUSED","P_ENV_LEVEL1","P_A2","P_D2","P_S2","P_R2","P_ENV2_UNUSED","P_DLSEND","P_DLTIME","P_DLRATIO","P_DLWOB","P_DLFB","P_TEMPO","P_RVSEND","P_RVTIME","P_RVSHIM","P_RVWOB","P_RVUNUSED","P_SWING","P_ARPONOFF","P_ARPMODE","P_ARPDIV","P_ARPPROB","P_ARPLEN","P_ARPOCT","P_LATCHONOFF","P_SEQMODE","P_SEQDIV","P_SEQPROB","P_SEQLEN","P_GATE_LENGTH","P_SMP_POS","P_SMP_GRAINSIZE","P_SMP_RATE","P_SMP_TIME","P_SAMPLE","P_SEQPAT","P_JIT_POS","P_JIT_GRAINSIZE","P_JIT_RATE","P_JIT_PULSE","P_JIT_UNUSED","P_SEQSTEP","P_ASCALE","P_AOFFSET","P_ADEPTH","P_AFREQ","P_ASHAPE","P_AWARP","P_BSCALE","P_BOFFSET","P_BDEPTH","P_BFREQ","P_BSHAPE","P_BWARP","P_XSCALE","P_XOFFSET","P_XDEPTH","P_XFREQ","P_XSHAPE","P_XWARP","P_YSCALE","P_YOFFSET","P_YDEPTH","P_YFREQ","P_YSHAPE","P_YWARP","P_MIXSYNTH","P_MIXWETDRY","P_MIXHPF","P_MIX_UNUSED","P_CV_QUANT","P_HEADPHONE","P_MIXINPUT","P_MIXINWETDRY","P_SYS_UNUSED1","P_SYS_UNUSED2","P_SYS_UNUSED3","P_ACCEL_SENS","P_LAST"],vt=[];const yt=(e,n)=>{const r=pt(e,(t=>{r===t&&(console.log("[MachineStore] state",t.machine.current,"context",t.context),o.set({state:t.machine.current,context:t.context}))}),n),o=function(e,n=t){let r;const o=[];function c(t){if(s(e,t)&&(e=t,r)){const t=!vt.length;for(let t=0;t<o.length;t+=1){const n=o[t];n[1](),vt.push(n,e)}if(t){for(let t=0;t<vt.length;t+=2)vt[t][0](vt[t+1]);vt.length=0}}}return{set:c,update:function(t){c(t(e))},subscribe:function(s,a=t){const i=[s,a];return o.push(i),1===o.length&&(r=n(c)||t),s(e),()=>{const t=o.indexOf(i);-1!==t&&o.splice(t,1),0===o.length&&(r(),r=null)}}}}({state:e.current,context:r.context}),c=r.send;return{store:o,send:c,service:r}};const Et={idle:ct(nt("getHeader",(St=async function(t){console.log("sendPatchRequest",t.port,t.patchNumber);const e=new Uint8Array([243,15,171,202,0,t.patchNumber,0,0,0,0]);return t.port.send(e),!0},J(((t,e)=>!!~St(t,e)&&t))))),getHeader:ct(et("data","header",G((function(t,e){console.log("hasHeader",t,e);const n=new Uint8Array(e.data);return!!n&&(10===n.byteLength&&(243===n[0]&&(15===n[1]&&(171===n[2]&&(202===n[3]&&(1===n[4]&&(0===n[6]&&0===n[7])))))))})))),header:ct(nt("read",J((function(t,e){const n=new Uint8Array(e.data);return t.result=[],t.header=n,t.slot=n[5],t.readBytes=0,t.bytesToRead=n[8]+256*n[9],console.log(`Loading from slot: ${t.slot} - Expecting ${t.bytesToRead} bytes (header: ${t.header})`),t})))),read:ct(nt("finished",G((function(t){return t.readBytes>=t.bytesToRead}))),et("data","read",J((function(t,e){const n=new Uint8Array(e.data);return t.result.push(n),t.readBytes+=n.byteLength,t})))),finished:ct()};var St;ct(et("header"));const xt=dt(Et,(t=>({...t})));class Nt extends _t{onReceive(t){console.log("Port data:",t.buffer);const{service:e}=At;e.child?e.child.send({type:"data",data:t.buffer}):e.send({type:"data",data:t.buffer})}onReceiveError(t){console.error("Port error:",t);const{send:e}=At;e({type:"error",data:t})}}function It(t){let e=[];return gt.forEach(((n,r)=>{const o=16*r,s=t.slice(o,16*r+16),c=new Int16Array(s);console.log(n,16,o,"BUF",s,c),e.push({name:n,value:c[0],mods:{env:c[1],pressure:c[2],a:c[3],b:c[4],x:c[5],y:c[6],random:c[7]}})})),e}async function Ot(t){return t.port=await class{constructor(){}static async getPorts(t){return navigator.usb.getDevices().then((e=>e.map((e=>t?new t(e):new _t(e)))))}static async requestPort(t){return navigator.usb.requestDevice({filters:[{vendorId:9114},{vendorId:51966}]}).then((e=>new t?new t(e):new _t(e)))}}.requestPort(Nt),await t.port.connect(),t}const At=function(t={}){const e=dt({disconnected:ct(et("connect","connecting"),et("parsePatch","disconnected",J(((t,e)=>{if(console.log("foo",e,t),e.patch){const n=e.patch,r=n.buffer.slice(n.byteOffset,n.byteLength+n.byteOffset),o=It(r);return{...t,patchJSON:o,patch:r}}return{...t}})))),connecting:lt(Ot,et("done","connected"),et("error","error",J(((t,e)=>(console.log(e.error),{...t,error:e.error}))))),connected:ct(et("loadPatch","loadPatch",J(((t,e)=>(console.log("ctx",t,e),{...t,patchNumber:e.patchNumber})))),et("savePatch","savePatch"),et("clearPatch","clearPatch")),clearPatch:ct(nt("connected",J((t=>(t.patch=null,t.patchJSON={},{...t}))))),loadPatch:lt(xt,et("done","connected",J(((t,e)=>{const n=Uint8Array.from(Array.prototype.concat(...e.data.result.map((t=>Array.from(t))))),r=n.buffer.slice(n.byteOffset,n.byteLength+n.byteOffset);return{...t,patch:r,patchJSON:It(r)}}))),et("error","error",J(((t,e)=>({...t,error:e.error}))))),savePatch:ct(),error:ct(et("connect","connecting",J((t=>(t.error=null,{...t})))))},(t=>({...t})));return yt(e,Object.assign(t,{port:null,patch:null,patchJSON:{}}))}({patchNumber:0});function $t(t,e,n){const r=t.slice();return r[19]=e[n],r}function wt(t){let e,n,r=t[0].context.error+"";return{c(){e=u("p"),n=d(r),p(e,"class","error")},m(t,r){i(t,e,r),a(e,n)},p(t,e){1&e&&r!==(r=t[0].context.error+"")&&b(n,r)},d(t){t&&l(e)}}}function Rt(t){let e;return{c(){e=u("p"),e.innerHTML='You need the 0.9l firmware (or newer) to use this!<br/><a href="https://plinkysynth.com/firmware">Download here!</a>'},m(t,n){i(t,e,n)},d(t){t&&l(e)}}}function Tt(e){let n;return{c(){n=u("p"),n.textContent="No patch in browser memory"},m(t,e){i(t,n,e)},p:t,d(t){t&&l(n)}}}function Ct(t){let e,n,r,o,s,c,P,m,_,g,v,y,E,S,x=t[0].context.patch.byteLength+"",N=t[0].context.patchJSON,I=[];for(let e=0;e<N.length;e+=1)I[e]=Lt($t(t,N,e));return{c(){e=u("button"),e.textContent="Clear patch in browser memory",n=h(),r=u("label"),r.textContent="Link:",o=h(),s=u("input"),c=h(),P=u("p"),m=d("Loaded: "),_=d(x),g=d(" bytes"),v=h(),y=u("ul");for(let t=0;t<I.length;t+=1)I[t].c();p(e,"class","svelte-b06694"),p(r,"for","i-link-url"),s.value=t[4],p(s,"id","i-link-url"),p(y,"class","params svelte-b06694")},m(l,u){i(l,e,u),i(l,n,u),i(l,r,u),i(l,o,u),i(l,s,u),i(l,c,u),i(l,P,u),a(P,m),a(P,_),a(P,g),i(l,v,u),i(l,y,u);for(let t=0;t<I.length;t+=1)I[t].m(y,null);E||(S=f(e,"click",function(t){return function(e){return e.preventDefault(),t.call(this,e)}}(t[8])),E=!0)},p(t,e){if(16&e&&s.value!==t[4]&&(s.value=t[4]),1&e&&x!==(x=t[0].context.patch.byteLength+"")&&b(_,x),513&e){let n;for(N=t[0].context.patchJSON,n=0;n<N.length;n+=1){const r=$t(t,N,n);I[n]?I[n].p(r,e):(I[n]=Lt(r),I[n].c(),I[n].m(y,null))}for(;n<I.length;n+=1)I[n].d(1);I.length=N.length}},d(t){t&&l(e),t&&l(n),t&&l(r),t&&l(o),t&&l(s),t&&l(c),t&&l(P),t&&l(v),t&&l(y),function(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}(I,t),E=!1,S()}}}function Lt(t){let e,n,r,o,s,c,f,P,m,_,g,v,y,E,S,x,N,I,O,A,$,w,R,T,C,L,D,U,M,k,q,F,H,B,Q,Y,V,X,j,J,W,G,z,Z,K,tt,et,nt,rt,ot,st,ct,at,it,lt,ut,dt,ht,ft,pt,Pt,bt,mt,_t,gt,vt,yt,Et,St,xt,Nt,It=t[19].name+"",Ot=Mt(t[9](t[19].value))+"",At=Mt(t[9](t[19].mods.env))+"",$t=Mt(t[9](t[19].mods.pressure))+"",wt=Mt(t[9](t[19].mods.a))+"",Rt=Mt(t[9](t[19].mods.b))+"",Tt=Mt(t[9](t[19].mods.x))+"",Ct=Mt(t[9](t[19].mods.y))+"",Lt=Mt(t[9](t[19].mods.random))+"";return{c(){e=u("li"),n=u("h3"),r=d(It),o=h(),s=u("div"),c=u("table"),f=u("tr"),P=u("td"),P.textContent="Base",m=h(),_=u("td"),g=d(Ot),v=d("%"),y=u("br"),E=h(),S=u("tr"),x=u("td"),x.textContent="Env",N=h(),I=u("td"),O=d(At),A=d("%"),$=u("br"),w=h(),R=u("tr"),T=u("td"),T.textContent="Pressure",C=h(),L=u("td"),D=d($t),U=d("%"),M=u("br"),k=h(),q=u("tr"),F=u("td"),F.textContent="A",H=h(),B=u("td"),Q=d(wt),Y=d("%"),V=u("br"),X=h(),j=u("table"),J=u("tr"),W=u("td"),W.textContent="B",G=h(),z=u("td"),Z=d(Rt),K=d("%"),tt=u("br"),et=h(),nt=u("tr"),rt=u("td"),rt.textContent="X",ot=h(),st=u("td"),ct=d(Tt),at=d("%"),it=u("br"),lt=h(),ut=u("tr"),dt=u("td"),dt.textContent="Y",ht=h(),ft=u("td"),pt=d(Ct),Pt=d("%"),bt=u("br"),mt=h(),_t=u("tr"),gt=u("td"),gt.textContent="Random",vt=h(),yt=u("td"),Et=d(Lt),St=d("%"),xt=u("br"),Nt=h(),p(n,"class","svelte-b06694"),p(P,"class","svelte-b06694"),p(_,"class","svelte-b06694"),p(x,"class","svelte-b06694"),p(I,"class","svelte-b06694"),p(T,"class","svelte-b06694"),p(L,"class","svelte-b06694"),p(F,"class","svelte-b06694"),p(B,"class","svelte-b06694"),p(c,"class","svelte-b06694"),p(W,"class","svelte-b06694"),p(z,"class","svelte-b06694"),p(rt,"class","svelte-b06694"),p(st,"class","svelte-b06694"),p(dt,"class","svelte-b06694"),p(ft,"class","svelte-b06694"),p(gt,"class","svelte-b06694"),p(yt,"class","svelte-b06694"),p(j,"class","svelte-b06694"),p(s,"class","mods svelte-b06694"),p(e,"class","svelte-b06694")},m(t,l){i(t,e,l),a(e,n),a(n,r),a(e,o),a(e,s),a(s,c),a(c,f),a(f,P),a(f,m),a(f,_),a(_,g),a(_,v),a(_,y),a(c,E),a(c,S),a(S,x),a(S,N),a(S,I),a(I,O),a(I,A),a(I,$),a(c,w),a(c,R),a(R,T),a(R,C),a(R,L),a(L,D),a(L,U),a(L,M),a(c,k),a(c,q),a(q,F),a(q,H),a(q,B),a(B,Q),a(B,Y),a(B,V),a(s,X),a(s,j),a(j,J),a(J,W),a(J,G),a(J,z),a(z,Z),a(z,K),a(z,tt),a(j,et),a(j,nt),a(nt,rt),a(nt,ot),a(nt,st),a(st,ct),a(st,at),a(st,it),a(j,lt),a(j,ut),a(ut,dt),a(ut,ht),a(ut,ft),a(ft,pt),a(ft,Pt),a(ft,bt),a(j,mt),a(j,_t),a(_t,gt),a(_t,vt),a(_t,yt),a(yt,Et),a(yt,St),a(yt,xt),a(e,Nt)},p(t,e){1&e&&It!==(It=t[19].name+"")&&b(r,It),1&e&&Ot!==(Ot=Mt(t[9](t[19].value))+"")&&b(g,Ot),1&e&&At!==(At=Mt(t[9](t[19].mods.env))+"")&&b(O,At),1&e&&$t!==($t=Mt(t[9](t[19].mods.pressure))+"")&&b(D,$t),1&e&&wt!==(wt=Mt(t[9](t[19].mods.a))+"")&&b(Q,wt),1&e&&Rt!==(Rt=Mt(t[9](t[19].mods.b))+"")&&b(Z,Rt),1&e&&Tt!==(Tt=Mt(t[9](t[19].mods.x))+"")&&b(ct,Tt),1&e&&Ct!==(Ct=Mt(t[9](t[19].mods.y))+"")&&b(pt,Ct),1&e&&Lt!==(Lt=Mt(t[9](t[19].mods.random))+"")&&b(Et,Lt)},d(t){t&&l(e)}}}function Dt(e){let n,o,s,c,g,v,y,E,S,x,N,I,O,A,$,w,R,T,C,L,D,U,M,k,q,F,H,B=e[0].state+"",Q=e[3]&&wt(e),Y=!e[1]&&Rt();function V(t,e){return t[0].context.patch?Ct:Tt}let X=V(e),j=X(e);return{c(){n=u("main"),o=u("h1"),o.textContent="Plinky WebUSB playground",s=h(),c=u("h2"),g=d("Current state: "),v=d(B),y=h(),Q&&Q.c(),E=h(),Y&&Y.c(),S=h(),x=u("button"),N=d("Connect"),I=h(),O=u("div"),A=u("label"),A.textContent="Patch number",$=h(),w=u("input"),R=h(),T=u("button"),C=d("Load patch"),L=h(),D=u("button"),U=d("Save patch"),M=h(),k=u("h2"),k.textContent="Current patch",q=h(),j.c(),p(o,"class","svelte-b06694"),_(x,"display",e[1]?"none":"block"),p(x,"class","svelte-b06694"),p(A,"for","i-patch-number"),p(w,"type","number"),w.disabled=e[2],p(w,"id","i-patch-number"),T.disabled=e[2],p(T,"class","svelte-b06694"),D.disabled=e[2],p(D,"class","svelte-b06694"),_(O,"display",e[1]?"block":"none"),p(n,"class","svelte-b06694")},m(t,r){i(t,n,r),a(n,o),a(n,s),a(n,c),a(c,g),a(c,v),a(n,y),Q&&Q.m(n,null),a(n,E),Y&&Y.m(n,null),a(n,S),a(n,x),a(x,N),a(n,I),a(n,O),a(O,A),a(O,$),a(O,w),m(w,e[0].context.patchNumber),a(O,R),a(O,T),a(T,C),a(O,L),a(O,D),a(D,U),a(n,M),a(n,k),a(n,q),j.m(n,null),F||(H=[f(x,"click",e[6]),f(w,"input",e[10]),f(T,"click",e[7]),f(D,"click",Ut)],F=!0)},p(t,[e]){1&e&&B!==(B=t[0].state+"")&&b(v,B),t[3]?Q?Q.p(t,e):(Q=wt(t),Q.c(),Q.m(n,E)):Q&&(Q.d(1),Q=null),t[1]?Y&&(Y.d(1),Y=null):Y||(Y=Rt(),Y.c(),Y.m(n,S)),2&e&&_(x,"display",t[1]?"none":"block"),4&e&&(w.disabled=t[2]),1&e&&P(w.value)!==t[0].context.patchNumber&&m(w,t[0].context.patchNumber),4&e&&(T.disabled=t[2]),4&e&&(D.disabled=t[2]),2&e&&_(O,"display",t[1]?"block":"none"),X===(X=V(t))&&j?j.p(t,e):(j.d(1),j=X(t),j&&(j.c(),j.m(n,null)))},i:t,o:t,d(t){t&&l(n),Q&&Q.d(),Y&&Y.d(),j.d(),F=!1,r(H)}}}function Ut(){}function Mt(t){return Math.round(100*t+Number.EPSILON)/100}function kt(t,e,n){let r,o,s,a,i;const{store:l,send:u,service:d}=At;c(t,l,(t=>n(0,i=t))),y((()=>{let t=new URL(document.location).searchParams.get("p");if(t){const r=(n=decodeURIComponent(t),e=n.split("").map(((t,e,n)=>e%2?void 0:new Array(2+parseInt(n[e+1],36)).join(t))).join(""),Uint8Array.from(atob(e),mt));console.log("patch: ",t,r),u({type:"parsePatch",patch:r})}var e,n}));return t.$$.update=()=>{1&t.$$.dirty&&n(1,r=["connected","loadPatch","savePatch"].indexOf(i.state)>-1),1&t.$$.dirty&&n(2,o=["loadPatch","savePatch"].indexOf(i.state)>-1),1&t.$$.dirty&&n(3,s=["error"].indexOf(i.state)>-1),1&t.$$.dirty&&n(4,a=location.protocol+"//"+location.host+location.pathname+"?p="+encodeURIComponent((t=>{const e=[];for(let n=0,{length:r}=t;n<r;n++)e.push(bt(t[n]));return btoa(e.join(""))})(new Uint8Array(i.context.patch)).split("").reduce(((t,e)=>(t[t.length-2]===e&&t[t.length-1]<35?t[t.length-1]++:t.push(e,0),t)),[]).map((t=>"number"==typeof t?t.toString(36):t)).join("")))},[i,r,o,s,a,l,async function(){u("connect")},function(){u({type:"loadPatch",patchNumber:i.context.patchNumber})},function(){const t=window.location.toString();t.indexOf("?")>0&&window.history.replaceState({},document.title,t.substring(0,t.indexOf("?"))),u({type:"clearPatch"})},function(t){return(t- -1024)/2048*200-100},function(){i.context.patchNumber=P(this.value),l.set(i)}]}return new class extends class{$destroy(){!function(t,e){const n=t.$$;null!==n.fragment&&(r(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}(this,1),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}{constructor(t){super(),D(this,t,kt,Dt,s,{})}}({target:document.body})}();
//# sourceMappingURL=bundle.js.map
