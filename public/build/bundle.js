var app=function(){"use strict";function t(){}function e(t){return t()}function n(){return Object.create(null)}function r(t){t.forEach(e)}function o(t){return"function"==typeof t}function c(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function s(e,n,r){e.$$.on_destroy.push(function(e,...n){if(null==e)return t;const r=e.subscribe(...n);return r.unsubscribe?()=>r.unsubscribe():r}(n,r))}function a(t,e){t.appendChild(e)}function i(t,e,n){t.insertBefore(e,n||null)}function l(t){t.parentNode.removeChild(t)}function u(t){return document.createElement(t)}function d(t){return document.createTextNode(t)}function h(){return d(" ")}function f(t,e,n,r){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)}function p(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function P(t){return""===t?null:+t}function m(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}function g(t,e){t.value=null==e?"":e}function b(t,e,n,r){t.style.setProperty(e,n,r?"important":"")}let _;function y(t){_=t}function v(t){(function(){if(!_)throw new Error("Function called outside component initialization");return _})().$$.on_mount.push(t)}const E=[],S=[],x=[],N=[],A=Promise.resolve();let O=!1;function w(t){x.push(t)}let I=!1;const $=new Set;function k(){if(!I){I=!0;do{for(let t=0;t<E.length;t+=1){const e=E[t];y(e),T(e.$$)}for(y(null),E.length=0;S.length;)S.pop()();for(let t=0;t<x.length;t+=1){const e=x[t];$.has(e)||($.add(e),e())}x.length=0}while(E.length);for(;N.length;)N.pop()();O=!1,I=!1,$.clear()}}function T(t){if(null!==t.fragment){t.update(),r(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(w)}}const L=new Set;function R(t,e){-1===t.$$.dirty[0]&&(E.push(t),O||(O=!0,A.then(k)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function C(c,s,a,i,u,d,h=[-1]){const f=_;y(c);const p=c.$$={fragment:null,ctx:null,props:d,update:t,not_equal:u,bound:n(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(f?f.$$.context:[]),callbacks:n(),dirty:h,skip_bound:!1};let P=!1;if(p.ctx=a?a(c,s.props||{},((t,e,...n)=>{const r=n.length?n[0]:e;return p.ctx&&u(p.ctx[t],p.ctx[t]=r)&&(!p.skip_bound&&p.bound[t]&&p.bound[t](r),P&&R(c,t)),e})):[],p.update(),P=!0,r(p.before_update),p.fragment=!!i&&i(p.ctx),s.target){if(s.hydrate){const t=function(t){return Array.from(t.childNodes)}(s.target);p.fragment&&p.fragment.l(t),t.forEach(l)}else p.fragment&&p.fragment.c();s.intro&&((m=c.$$.fragment)&&m.i&&(L.delete(m),m.i(g))),function(t,n,c){const{fragment:s,on_mount:a,on_destroy:i,after_update:l}=t.$$;s&&s.m(n,c),w((()=>{const n=a.map(e).filter(o);i?i.push(...n):r(n),t.$$.on_mount=[]})),l.forEach(w)}(c,s.target,s.anchor),k()}var m,g;y(f)}function U(t){return{enumerable:!0,value:t}}function D(t){return{enumerable:!0,writable:!0,value:t}}let M={},H=()=>!0,q=()=>({}),B=t=>t,F=(t,e,n,r)=>t.apply(n,r)&&e.apply(n,r),J=(t,e,n,[r,o])=>e.call(n,t.call(n,r,o),o),Q=(t,e)=>Object.freeze(Object.create(t,e));function V(t,e,n){return t.reduce(((t,e)=>function(...r){return n(t,e,this,r)}),e)}function Y(t){return Q(this,{fn:U(t)})}let X={},j=Y.bind(X),W=t=>j(((e,n)=>!!~t(e,n)&&e)),G={},z=Y.bind(G);function Z(t,e){return e.filter((e=>t.isPrototypeOf(e)))}function K(t,e,...n){let r=V(Z(G,n).map((t=>t.fn)),H,F),o=V(Z(X,n).map((t=>t.fn)),B,J);return Q(this,{from:U(t),to:U(e),guards:U(r),reducers:U(o)})}let tt={},et={},nt=K.bind(tt),rt=K.bind(et,null);function ot(t,e,n){return ft(e,t,n,this.immediates)||t}function ct(t){let e=new Map;for(let n of t)e.has(n.from)||e.set(n.from,[]),e.get(n.from).push(n);return e}let st={enter:B};function at(...t){let e=Z(tt,t),n=Z(et,t),r={final:U(0===t.length),transitions:U(ct(e))};return n.length&&(r.immediates=U(n),r.enter=U(ot)),Q(st,r)}let it={enter(t,e,n){return this.fn.call(e,e.context,n).then((t=>e.send({type:"done",data:t}))).catch((t=>e.send({type:"error",error:t}))),t}},lt={enter(t,e,n){if(e.child=Pt(this.machine,(t=>{e.onChange(t),e.child==t&&t.machine.state.value.final&&(delete e.child,e.send({type:"done",data:t.context}))}),e.context,n),e.child.machine.state.value.final){let n=e.child.context;return delete e.child,ft(e,t,{type:"done",data:n},this.transitions.get("done"))}return t}};function ut(t,...e){let n=U(ct(e));return dt.isPrototypeOf(t)?Q(lt,{machine:U(t),transitions:n}):Q(it,{fn:U(t),transitions:n})}let dt={get state(){return{name:this.current,value:this.states[this.current]}}};function ht(t,e,n=q){return"string"!=typeof t&&(n=e||q,e=t,t=Object.keys(e)[0]),M._create&&M._create(t,e),Q(dt,{context:U(n),current:U(t),states:U(e)})}function ft(t,e,n,r){let{context:o}=t;for(let{to:c,guards:s,reducers:a}of r)if(s(o,n)){t.context=a.call(t,o,n);let r=e.original||e,s=Q(r,{current:U(c),original:{value:r}});return s.state.value.enter(s,t,n)}}let pt={send(t){this.machine=function(t,e){let n=e.type||e,{machine:r}=t,{value:o}=r.state;return o.transitions.has(n)&&ft(t,r,e,o.transitions.get(n))||r}(this,t),this.onChange(this)}};function Pt(t,e,n,r){let o=Object.create(pt,{machine:D(t),context:D(t.context(n,r)),onChange:U(e)});return o.send=o.send.bind(o),o.machine=o.machine.state.value.enter(o.machine,o,r),o}function mt(t,e){throw new Error(`Cannot transition from ${t} to unknown state: ${e}`)}M._create=function(t,e){if(!(t in e))throw new Error(`Initial state [${t}] is not a known state.`);for(let t in e){let n=e[t];for(let[,r]of n.transitions)for(let{to:n}of r)n in e||mt(t,n)}};const{fromCharCode:gt}=String,bt=t=>t.charCodeAt(0);function _t(t){return t.processedBytes>=t.bytesToProcess}const yt={idle:at(rt("getHeader",W((async function(t){console.log("sendLoadRequest",t.port,"patchNumber",t.patchNumber);const e=new Uint8Array([243,15,171,202,0,t.patchNumber,0,0,0,0]);return t.port.send(e),!0})))),getHeader:at(nt("data","header",z((function(t,e){console.log("hasHeader",t,e);const n=new Uint8Array(e.data);return!!n&&(10===n.byteLength&&(243===n[0]&&(15===n[1]&&(171===n[2]&&(202===n[3]&&(1===n[4]&&(0===n[6]&&0===n[7])))))))})))),header:at(rt("read",j((function(t,e){const n=new Uint8Array(e.data);return t.result=[],t.header=n,t.slot=n[5],t.processedBytes=0,t.bytesToProcess=n[8]+256*n[9],console.log(`Loading from slot: ${t.slot} - Expecting ${t.bytesToProcess} bytes (header: ${t.header})`),t})))),read:at(rt("finished",z(_t)),nt("data","read",j((function(t,e){const n=new Uint8Array(e.data);return t.result.push(n),t.processedBytes+=n.byteLength,t})))),finished:at()};const vt={idle:at(rt("setHeader",j((t=>{const e=new Uint8Array(t.patch);return console.log("ctx",t,e.byteLength),{...t,processedBytes:0,bytesToProcess:e.byteLength,data:e,currentIteration:0}})))),setHeader:at(rt("write",W((async function(t){console.log("sendWriteRequest",t.port,"patchNumber",t.patchNumber);let e=new ArrayBuffer(4);new DataView(e).setUint32(0,t.bytesToProcess,!0);const n=new Uint8Array(e),r=new Uint8Array([243,15,171,202,1,t.patchNumber,0,0,n[0],n[1]]);return console.log("sending buf",r,"ctx.bytesToProcess",t.bytesToProcess,"len.byteLength",n.byteLength,"len",n),t.port.send(r),!0})))),getDataFromPatch:at(rt("write",j((t=>({...t}))))),write:at(rt("finished",z(_t)),rt("getDataFromPatch",W((async function(t){const e=64*t.currentIteration,n=e+64,r=new Uint8Array(t.data).slice(e,n);return t.port.send(r),t.currentIteration++,t.processedBytes+=r.byteLength,t})))),finished:at()},Et=[];const St=(e,n)=>{const r=Pt(e,(t=>{r===t&&(console.log("[MachineStore] state",t.machine.current,"context",t.context),o.set({state:t.machine.current,context:t.context}))}),n),o=function(e,n=t){let r;const o=[];function s(t){if(c(e,t)&&(e=t,r)){const t=!Et.length;for(let t=0;t<o.length;t+=1){const n=o[t];n[1](),Et.push(n,e)}if(t){for(let t=0;t<Et.length;t+=2)Et[t][0](Et[t+1]);Et.length=0}}}return{set:s,update:function(t){s(t(e))},subscribe:function(c,a=t){const i=[c,a];return o.push(i),1===o.length&&(r=n(s)||t),c(e),()=>{const t=o.indexOf(i);-1!==t&&o.splice(t,1),0===o.length&&(r(),r=null)}}}}({state:e.current,context:r.context}),s=r.send;return{store:o,send:s,service:r}};class xt extends EventTarget{constructor(t){super(),this.device=t,this.interfaceNumber=0,this.endpointIn=0,this.endpointOut=0,this.queue=[],this.transferInflight=!1}onReceive(t){}onReceiveError(t){}setEndpoints(){let t=this.device.configuration.interfaces;console.log("Interfaces",this.device.configuration.interfaces),t.forEach((t=>{console.log("Element",t),t.alternates.forEach((e=>{255==e.interfaceClass&&(this.interfaceNumber=t.interfaceNumber,e.endpoints.forEach((t=>{"out"==t.direction&&(this.endpointOut=t.endpointNumber),"in"==t.direction&&(this.endpointIn=t.endpointNumber)})))}))})),0===this.endpointIn&&console.error("endpointIn is 0"),0===this.endpointOut&&console.error("endpointOut is 0")}async connect(){let t=async()=>{try{const e=await this.device.transferIn(this.endpointIn,64);this.onReceive(e.data),t()}catch(t){this.onReceiveError(t)}};try{if(await this.device.open(),null===this.device.configuration)return this.device.selectConfiguration(1);await this.setEndpoints(),console.log("Interface number:",this.interfaceNumber),console.log("Configuration:",this.device.configuration),await this.device.claimInterface(this.interfaceNumber);try{await this.device.selectAlternateInterface(this.interfaceNumber,this.endpointIn)}catch(t){}await this.device.controlTransferOut({requestType:"class",recipient:"interface",request:34,value:1,index:this.interfaceNumber}),t()}catch(t){throw console.error(t),t}}async disconnect(){return this.device.controlTransferOut({requestType:"class",recipient:"interface",request:34,value:0,index:this.interfaceNumber}).then((()=>this.device.close()))}send(t){return console.log("sending",t,this.endpointOut),this.device.transferOut(this.endpointOut,t)}queueMessage(t){if(queue.length>5e3)return console.warn("You have queued too many messages, have more chill");this.queue.push(t)}async processQueue(){if(0===this.queue.length)return;if(this.transferInflight)return;this.transferInflight=!0;const t=this.queue.shift();try{await this.send(t)}catch(e){console.error(e),this.queue.unshift(t)}this.transferInflight=!1}startQueue(){this.stopQueue(),this.queueInterval=setInterval(this.processQueue.bind(this),1)}stopQueue(){this.queueInterval&&clearInterval(this.queueInterval)}}const Nt=["P_PWM","P_DRIVE","P_PITCH","P_OCT","P_GLIDE","P_INTERVAL","P_NOISE","P_MIXRESO","P_ROTATE","P_SCALE","P_MICROTUNE","P_STRIDE","P_SENS","P_A","P_D","P_S","P_R","P_ENV1_UNUSED","P_ENV_LEVEL1","P_A2","P_D2","P_S2","P_R2","P_ENV2_UNUSED","P_DLSEND","P_DLTIME","P_DLRATIO","P_DLWOB","P_DLFB","P_TEMPO","P_RVSEND","P_RVTIME","P_RVSHIM","P_RVWOB","P_RVUNUSED","P_SWING","P_ARPONOFF","P_ARPMODE","P_ARPDIV","P_ARPPROB","P_ARPLEN","P_ARPOCT","P_LATCHONOFF","P_SEQMODE","P_SEQDIV","P_SEQPROB","P_SEQLEN","P_GATE_LENGTH","P_SMP_POS","P_SMP_GRAINSIZE","P_SMP_RATE","P_SMP_TIME","P_SAMPLE","P_SEQPAT","P_JIT_POS","P_JIT_GRAINSIZE","P_JIT_RATE","P_JIT_PULSE","P_JIT_UNUSED","P_SEQSTEP","P_ASCALE","P_AOFFSET","P_ADEPTH","P_AFREQ","P_ASHAPE","P_AWARP","P_BSCALE","P_BOFFSET","P_BDEPTH","P_BFREQ","P_BSHAPE","P_BWARP","P_XSCALE","P_XOFFSET","P_XDEPTH","P_XFREQ","P_XSHAPE","P_XWARP","P_YSCALE","P_YOFFSET","P_YDEPTH","P_YFREQ","P_YSHAPE","P_YWARP","P_MIXSYNTH","P_MIXWETDRY","P_MIXHPF","P_MIX_UNUSED","P_CV_QUANT","P_HEADPHONE","P_MIXINPUT","P_MIXINWETDRY","P_SYS_UNUSED1","P_SYS_UNUSED2","P_SYS_UNUSED3","P_ACCEL_SENS"];function At(t){let e={arp:!1,latch:!1,loopStart:0,loopLength:8,params:[]};Nt.forEach(((n,r)=>{const o=16*r,c=t.slice(o,16*r+16),s=new Int16Array(c);e.params.push({name:n,buffer:c,value:s[0],enum:null,mods:{env:s[1],pressure:s[2],a:s[3],b:s[4],x:s[5],y:s[6],random:s[7]}})}));const n=t.slice(t.byteLength-16,t.byteLength);return e.arp=(1&new Uint8Array(n)[0])>0,e.latch=(2&new Uint8Array(n)[0])>0,e.loopStart=new Int8Array(n)[1],e.loopLength=new Int8Array(n)[2],console.log("bitfield",n,e),e}const Ot=ht(yt,(t=>({...t}))),wt=ht(vt,(t=>({...t})));class It extends xt{onReceive(t){console.log("Port data:",t.buffer);const{service:e}=kt;e.child?e.child.send({type:"data",data:t.buffer}):e.send({type:"data",data:t.buffer})}onReceiveError(t){console.error("Port error:",t);const{send:e}=kt;e({type:"error",data:t})}}async function $t(t){return t.port=await class{constructor(){}static async getPorts(t){return navigator.usb.getDevices().then((e=>e.map((e=>t?new t(e):new Port(e)))))}static async requestPort(t){return navigator.usb.requestDevice({filters:[{vendorId:9114},{vendorId:51966}]}).then((e=>new t?new t(e):new Port(e)))}}.requestPort(It),await t.port.connect(),t}const kt=function(t={}){const e=ht({disconnected:at(nt("connect","connecting"),nt("parsePatch","disconnected",j(((t,e)=>{if(e.patch){const n=e.patch,r=n.buffer.slice(n.byteOffset,n.byteLength+n.byteOffset),o=At(r);return{...t,patchJSON:o,patch:r}}return{...t}})))),connecting:ut($t,nt("done","connected"),nt("error","error",j(((t,e)=>({...t,error:e.error}))))),connected:at(nt("loadPatch","loadPatch",j(((t,e)=>({...t,patchNumber:e.patchNumber})))),nt("savePatch","savePatch"),nt("clearPatch","clearPatch"),nt("error","error",j(((t,e)=>({...t,error:e.error}))))),clearPatch:at(rt("connected",j((t=>(t.patch=null,t.patchJSON={},{...t}))))),loadPatch:ut(Ot,nt("done","connected",j(((t,e)=>{const n=Uint8Array.from(Array.prototype.concat(...e.data.result.map((t=>Array.from(t))))),r=n.buffer.slice(n.byteOffset,n.byteLength+n.byteOffset);return{...t,patch:r,patchJSON:At(r)}}))),nt("error","error",j(((t,e)=>({...t,error:e.error}))))),savePatch:ut(wt,nt("done","connected"),nt("error","error",j(((t,e)=>({...t,error:e.error}))))),error:at(nt("connect","connecting",j((t=>(t.error=null,{...t})))))},(t=>({...t})));return St(e,Object.assign(t,{port:null,patch:null,patchJSON:{}}))}({patchNumber:0});function Tt(t,e,n){const r=t.slice();return r[20]=e[n],r}function Lt(t){let e,n,r=t[0].context.error+"";return{c(){e=u("p"),n=d(r),p(e,"class","error")},m(t,r){i(t,e,r),a(e,n)},p(t,e){1&e&&r!==(r=t[0].context.error+"")&&m(n,r)},d(t){t&&l(e)}}}function Rt(t){let e;return{c(){e=u("p"),e.innerHTML='You need the 0.9l firmware (or newer) to use this!<br/><a href="https://plinkysynth.com/firmware">Download here!</a>'},m(t,n){i(t,e,n)},d(t){t&&l(e)}}}function Ct(e){let n;return{c(){n=u("p"),n.textContent="No patch in browser memory"},m(t,e){i(t,n,e)},p:t,d(t){t&&l(n)}}}function Ut(t){let e,n,r,o,c,s,P,g,b,_,y,v,E,S,x,N,A,O,w,I,$,k,T,L,R,C,U,D,M,H,q,B,F=t[0].context.patch.byteLength+"",J=t[0].context.patchJSON.arp+"",Q=t[0].context.patchJSON.latch+"",V=t[0].context.patchJSON.loopStart+"",Y=t[0].context.patchJSON.loopLength+"",X=t[0].context.patchJSON.params,j=[];for(let e=0;e<X.length;e+=1)j[e]=Dt(Tt(t,X,e));return{c(){e=u("button"),e.textContent="Clear patch in browser memory",n=h(),r=u("p"),o=d("Loaded: "),c=d(F),s=d(" bytes"),P=h(),g=u("h3"),g.textContent="Link to patch",b=h(),_=u("label"),_.textContent="Link:",y=h(),v=u("input"),E=h(),S=u("h3"),S.textContent="Params",x=h(),N=u("p"),A=d("Arp: "),O=d(J),w=u("br"),I=d("\n\t\t\tLatch: "),$=d(Q),k=u("br"),T=d("\n\t\t\tLoop start: "),L=d(V),R=u("br"),C=d("\n\t\t\tLoop length: "),U=d(Y),D=u("br"),M=h(),H=u("ul");for(let t=0;t<j.length;t+=1)j[t].c();p(e,"class","svelte-1k7gd8d"),p(_,"for","i-link-url"),v.value=t[4],p(v,"id","i-link-url"),p(H,"class","params svelte-1k7gd8d")},m(l,u){i(l,e,u),i(l,n,u),i(l,r,u),a(r,o),a(r,c),a(r,s),i(l,P,u),i(l,g,u),i(l,b,u),i(l,_,u),i(l,y,u),i(l,v,u),i(l,E,u),i(l,S,u),i(l,x,u),i(l,N,u),a(N,A),a(N,O),a(N,w),a(N,I),a(N,$),a(N,k),a(N,T),a(N,L),a(N,R),a(N,C),a(N,U),a(N,D),i(l,M,u),i(l,H,u);for(let t=0;t<j.length;t+=1)j[t].m(H,null);var d;q||(B=f(e,"click",(d=t[9],function(t){return t.preventDefault(),d.call(this,t)})),q=!0)},p(t,e){if(1&e&&F!==(F=t[0].context.patch.byteLength+"")&&m(c,F),16&e&&v.value!==t[4]&&(v.value=t[4]),1&e&&J!==(J=t[0].context.patchJSON.arp+"")&&m(O,J),1&e&&Q!==(Q=t[0].context.patchJSON.latch+"")&&m($,Q),1&e&&V!==(V=t[0].context.patchJSON.loopStart+"")&&m(L,V),1&e&&Y!==(Y=t[0].context.patchJSON.loopLength+"")&&m(U,Y),1025&e){let n;for(X=t[0].context.patchJSON.params,n=0;n<X.length;n+=1){const r=Tt(t,X,n);j[n]?j[n].p(r,e):(j[n]=Dt(r),j[n].c(),j[n].m(H,null))}for(;n<j.length;n+=1)j[n].d(1);j.length=X.length}},d(t){t&&l(e),t&&l(n),t&&l(r),t&&l(P),t&&l(g),t&&l(b),t&&l(_),t&&l(y),t&&l(v),t&&l(E),t&&l(S),t&&l(x),t&&l(N),t&&l(M),t&&l(H),function(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}(j,t),q=!1,B()}}}function Dt(t){let e,n,r,o,c,s,f,P,g,b,_,y,v,E,S,x,N,A,O,w,I,$,k,T,L,R,C,U,D,M,H,q,B,F,J,Q,V,Y,X,j,W,G,z,Z,K,tt,et,nt,rt,ot,ct,st,at,it,lt,ut,dt,ht,ft,pt,Pt,mt,gt,bt,_t,yt,vt,Et,St,xt,Nt,At,Ot,wt,It,$t,kt,Tt,Lt=t[20].name+"",Rt=Array.from(new Uint8Array(t[20].buffer)).map(qt)+"",Ct=new Uint8Array(t[20].buffer).toString()+"",Ut=Ht(t[10](t[20].value))+"",Dt=Ht(t[10](t[20].mods.env))+"",Mt=Ht(t[10](t[20].mods.pressure))+"",Bt=Ht(t[10](t[20].mods.a))+"",Ft=Ht(t[10](t[20].mods.b))+"",Jt=Ht(t[10](t[20].mods.x))+"",Qt=Ht(t[10](t[20].mods.y))+"",Vt=Ht(t[10](t[20].mods.random))+"";return{c(){e=u("li"),n=u("h3"),r=d(Lt),o=h(),c=u("code"),s=d("hex: "),f=d(Rt),P=u("br"),g=d("\n\t\t\t\t\t\tdec: "),b=d(Ct),_=h(),y=u("div"),v=u("table"),E=u("tr"),S=u("td"),S.textContent="Base",x=h(),N=u("td"),A=d(Ut),O=d("%"),w=u("br"),I=h(),$=u("tr"),k=u("td"),k.textContent="Env",T=h(),L=u("td"),R=d(Dt),C=d("%"),U=u("br"),D=h(),M=u("tr"),H=u("td"),H.textContent="Pressure",q=h(),B=u("td"),F=d(Mt),J=d("%"),Q=u("br"),V=h(),Y=u("tr"),X=u("td"),X.textContent="A",j=h(),W=u("td"),G=d(Bt),z=d("%"),Z=u("br"),K=h(),tt=u("table"),et=u("tr"),nt=u("td"),nt.textContent="B",rt=h(),ot=u("td"),ct=d(Ft),st=d("%"),at=u("br"),it=h(),lt=u("tr"),ut=u("td"),ut.textContent="X",dt=h(),ht=u("td"),ft=d(Jt),pt=d("%"),Pt=u("br"),mt=h(),gt=u("tr"),bt=u("td"),bt.textContent="Y",_t=h(),yt=u("td"),vt=d(Qt),Et=d("%"),St=u("br"),xt=h(),Nt=u("tr"),At=u("td"),At.textContent="Random",Ot=h(),wt=u("td"),It=d(Vt),$t=d("%"),kt=u("br"),Tt=h(),p(n,"class","svelte-1k7gd8d"),p(c,"class","svelte-1k7gd8d"),p(S,"class","svelte-1k7gd8d"),p(N,"class","svelte-1k7gd8d"),p(k,"class","svelte-1k7gd8d"),p(L,"class","svelte-1k7gd8d"),p(H,"class","svelte-1k7gd8d"),p(B,"class","svelte-1k7gd8d"),p(X,"class","svelte-1k7gd8d"),p(W,"class","svelte-1k7gd8d"),p(v,"class","svelte-1k7gd8d"),p(nt,"class","svelte-1k7gd8d"),p(ot,"class","svelte-1k7gd8d"),p(ut,"class","svelte-1k7gd8d"),p(ht,"class","svelte-1k7gd8d"),p(bt,"class","svelte-1k7gd8d"),p(yt,"class","svelte-1k7gd8d"),p(At,"class","svelte-1k7gd8d"),p(wt,"class","svelte-1k7gd8d"),p(tt,"class","svelte-1k7gd8d"),p(y,"class","mods svelte-1k7gd8d"),p(e,"class","svelte-1k7gd8d")},m(t,l){i(t,e,l),a(e,n),a(n,r),a(e,o),a(e,c),a(c,s),a(c,f),a(c,P),a(c,g),a(c,b),a(e,_),a(e,y),a(y,v),a(v,E),a(E,S),a(E,x),a(E,N),a(N,A),a(N,O),a(N,w),a(v,I),a(v,$),a($,k),a($,T),a($,L),a(L,R),a(L,C),a(L,U),a(v,D),a(v,M),a(M,H),a(M,q),a(M,B),a(B,F),a(B,J),a(B,Q),a(v,V),a(v,Y),a(Y,X),a(Y,j),a(Y,W),a(W,G),a(W,z),a(W,Z),a(y,K),a(y,tt),a(tt,et),a(et,nt),a(et,rt),a(et,ot),a(ot,ct),a(ot,st),a(ot,at),a(tt,it),a(tt,lt),a(lt,ut),a(lt,dt),a(lt,ht),a(ht,ft),a(ht,pt),a(ht,Pt),a(tt,mt),a(tt,gt),a(gt,bt),a(gt,_t),a(gt,yt),a(yt,vt),a(yt,Et),a(yt,St),a(tt,xt),a(tt,Nt),a(Nt,At),a(Nt,Ot),a(Nt,wt),a(wt,It),a(wt,$t),a(wt,kt),a(e,Tt)},p(t,e){1&e&&Lt!==(Lt=t[20].name+"")&&m(r,Lt),1&e&&Rt!==(Rt=Array.from(new Uint8Array(t[20].buffer)).map(qt)+"")&&m(f,Rt),1&e&&Ct!==(Ct=new Uint8Array(t[20].buffer).toString()+"")&&m(b,Ct),1&e&&Ut!==(Ut=Ht(t[10](t[20].value))+"")&&m(A,Ut),1&e&&Dt!==(Dt=Ht(t[10](t[20].mods.env))+"")&&m(R,Dt),1&e&&Mt!==(Mt=Ht(t[10](t[20].mods.pressure))+"")&&m(F,Mt),1&e&&Bt!==(Bt=Ht(t[10](t[20].mods.a))+"")&&m(G,Bt),1&e&&Ft!==(Ft=Ht(t[10](t[20].mods.b))+"")&&m(ct,Ft),1&e&&Jt!==(Jt=Ht(t[10](t[20].mods.x))+"")&&m(ft,Jt),1&e&&Qt!==(Qt=Ht(t[10](t[20].mods.y))+"")&&m(vt,Qt),1&e&&Vt!==(Vt=Ht(t[10](t[20].mods.random))+"")&&m(It,Vt)},d(t){t&&l(e)}}}function Mt(e){let n,o,c,s,_,y,v,E,S,x,N,A,O,w,I,$,k,T,L,R,C,U,D,M,H,q,B,F=e[0].state+"",J=e[3]&&Lt(e),Q=!e[1]&&Rt();function V(t,e){return t[0].context.patch?Ut:Ct}let Y=V(e),X=Y(e);return{c(){n=u("main"),o=u("h1"),o.textContent="Plinky WebUSB playground",c=h(),s=u("h2"),_=d("Current state: "),y=d(F),v=h(),J&&J.c(),E=h(),Q&&Q.c(),S=h(),x=u("button"),N=d("Connect"),A=h(),O=u("div"),w=u("label"),w.textContent="Patch number",I=h(),$=u("input"),k=h(),T=u("button"),L=d("Load patch"),R=h(),C=u("button"),U=d("Save patch"),D=h(),M=u("h2"),M.textContent="Current patch",H=h(),X.c(),p(o,"class","svelte-1k7gd8d"),b(x,"display",e[1]?"none":"block"),p(x,"class","svelte-1k7gd8d"),p(w,"for","i-patch-number"),p($,"type","number"),$.disabled=e[2],p($,"id","i-patch-number"),T.disabled=e[2],p(T,"class","svelte-1k7gd8d"),C.disabled=e[2],p(C,"class","svelte-1k7gd8d"),b(O,"display",e[1]?"block":"none"),p(n,"class","svelte-1k7gd8d")},m(t,r){i(t,n,r),a(n,o),a(n,c),a(n,s),a(s,_),a(s,y),a(n,v),J&&J.m(n,null),a(n,E),Q&&Q.m(n,null),a(n,S),a(n,x),a(x,N),a(n,A),a(n,O),a(O,w),a(O,I),a(O,$),g($,e[0].context.patchNumber),a(O,k),a(O,T),a(T,L),a(O,R),a(O,C),a(C,U),a(n,D),a(n,M),a(n,H),X.m(n,null),q||(B=[f(x,"click",e[6]),f($,"input",e[11]),f(T,"click",e[7]),f(C,"click",e[8])],q=!0)},p(t,[e]){1&e&&F!==(F=t[0].state+"")&&m(y,F),t[3]?J?J.p(t,e):(J=Lt(t),J.c(),J.m(n,E)):J&&(J.d(1),J=null),t[1]?Q&&(Q.d(1),Q=null):Q||(Q=Rt(),Q.c(),Q.m(n,S)),2&e&&b(x,"display",t[1]?"none":"block"),4&e&&($.disabled=t[2]),1&e&&P($.value)!==t[0].context.patchNumber&&g($,t[0].context.patchNumber),4&e&&(T.disabled=t[2]),4&e&&(C.disabled=t[2]),2&e&&b(O,"display",t[1]?"block":"none"),Y===(Y=V(t))&&X?X.p(t,e):(X.d(1),X=Y(t),X&&(X.c(),X.m(n,null)))},i:t,o:t,d(t){t&&l(n),J&&J.d(),Q&&Q.d(),X.d(),q=!1,r(B)}}}function Ht(t){return Math.round(100*t+Number.EPSILON)/100}const qt=t=>t.toString(16);function Bt(t,e,n){let r,o,c,a,i;const{store:l,send:u,service:d}=kt;s(t,l,(t=>n(0,i=t))),v((()=>{let t=new URL(document.location).searchParams.get("p");if(t){const r=(n=decodeURIComponent(t),e=n.split("").map(((t,e,n)=>e%2?void 0:new Array(2+parseInt(n[e+1],36)).join(t))).join(""),Uint8Array.from(atob(e),bt));console.log("patch: ",t,r),u({type:"parsePatch",patch:r})}var e,n}));return t.$$.update=()=>{1&t.$$.dirty&&n(1,r=["connected","loadPatch","savePatch"].indexOf(i.state)>-1),1&t.$$.dirty&&n(2,o=["loadPatch","savePatch"].indexOf(i.state)>-1),1&t.$$.dirty&&n(3,c=["error"].indexOf(i.state)>-1),1&t.$$.dirty&&n(4,a=location.protocol+"//"+location.host+location.pathname+"?p="+encodeURIComponent((t=>{const e=[];for(let n=0,{length:r}=t;n<r;n++)e.push(gt(t[n]));return btoa(e.join(""))})(new Uint8Array(i.context.patch)).split("").reduce(((t,e)=>(t[t.length-2]===e&&t[t.length-1]<35?t[t.length-1]++:t.push(e,0),t)),[]).map((t=>"number"==typeof t?t.toString(36):t)).join("")))},[i,r,o,c,a,l,async function(){u("connect")},function(){u({type:"loadPatch",patchNumber:i.context.patchNumber})},function(){u({type:"savePatch",patchNumber:i.context.patchNumber})},function(){const t=window.location.toString();t.indexOf("?")>0&&window.history.replaceState({},document.title,t.substring(0,t.indexOf("?"))),u({type:"clearPatch"})},function(t){return(t- -1024)/2048*200-100},function(){i.context.patchNumber=P(this.value),l.set(i)}]}return new class extends class{$destroy(){!function(t,e){const n=t.$$;null!==n.fragment&&(r(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}(this,1),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}{constructor(t){super(),C(this,t,Bt,Mt,c,{})}}({target:document.body})}();
//# sourceMappingURL=bundle.js.map
